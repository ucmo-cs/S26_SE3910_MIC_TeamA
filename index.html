<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bank Appointment Booking</title>
  <style>
    :root{
      --bg-1:#eef2ff;
      --bg-2:#f7fbff;
      --card:#ffffff;
      --accent:#0d6efd;
      --muted:#6b7280;
      --lime:#84cc16;
    }

    html,body{height:100%;}
    body {
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial;
      background: linear-gradient(135deg,var(--bg-1),var(--bg-2));
      margin: 0;
      padding: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      background: var(--card);
      padding: 28px 28px 20px 28px;
      border-radius: 14px;
      box-shadow: 0 8px 30px rgba(16,24,40,0.08);
      width: min(520px, 96%);
      border: 1px solid rgba(13,110,253,0.04);
    }

    h2 {
      margin: 0 0 8px 0;
      text-align: center;
      font-size: 20px;
      color: #0f172a;
    }

    p.lead{
      margin:0 0 18px 0;
      text-align:center;
      color:var(--muted);
      font-size:13px;
    }

    label {
      display: block;
      margin-top: 12px;
      font-weight: 600;
      color:#111827;
      font-size:13px;
    }

    input, select, button {
      width: 100%;
      padding: 10px 12px;
      margin-top: 6px;
      border-radius: 8px;
      border: 1px solid #e6e9ef;
      font-size: 14px;
      box-sizing: border-box;
      background: #fff;
    }

    select:focus, input:focus { outline: 2px solid rgba(13,110,253,0.12); }

    .row { display:flex; gap:12px; }
    .row .col { flex:1 }

    .form-grid{
      display:grid;
      grid-template-columns:repeat(2, 1fr);
      gap:12px;
      margin-top:8px;
    }

    .field-card{
      background: linear-gradient(180deg, rgba(132,204,22,0.06), #fff);
      border:1px solid rgba(132,204,22,0.14);
      padding:10px;
      border-radius:10px;
      box-shadow: 0 4px 14px rgba(16,24,40,0.04);
    }

    button {
      background: linear-gradient(180deg,var(--lime), #63b10f);
      color: #06370b;
      border: none;
      margin-top: 16px;
      cursor: pointer;
      font-weight: 700;
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(99,177,15,0.12);
    }

    button:active { transform: translateY(1px); }

    #message {
      margin-top: 14px;
      padding: 10px 12px;
      border-radius: 8px;
      min-height: 36px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:600;
    }

    #message.success { background: #ecfdf5; color: #065f46; border:1px solid #bbf7d0 }
    #message.error { background: #fff1f2; color: #9f1239; border:1px solid #fecaca }

    @media (max-width:480px){ .container{ padding:20px } }
  </style>
</head>
<body>
  <div class="container">
    <h2>Book an Appointment</h2>
    <p class="lead">Choose a topic, branch, date and time. Fields are separated for clarity.</p>

    <div class="form-grid">
      <div class="field-card">
        <label for="topic">Topic</label>
        <select id="topic"></select>
      </div>

      <div class="field-card">
        <label for="branch">Branch</label>
        <select id="branch"></select>
      </div>

      <div class="field-card">
        <label for="date">Date</label>
        <input type="date" id="date" />
      </div>

      <div class="field-card">
        <label for="time">Time Slot</label>
        <select id="time"></select>
      </div>

      <div class="field-card">
        <label for="name">Your Name</label>
        <input type="text" id="name" />
      </div>

      <div class="field-card">
        <label for="email">Email</label>
        <input type="email" id="email" />
      </div>
    </div>

    <button onclick="bookAppointment()">Confirm Booking</button>

    <div id="message"></div>
  </div>

  <script>
    const API_BASE = "/api";

    async function loadTopics() {
      const res = await fetch(`${API_BASE}/topics`);
      const topics = await res.json();

      const topicSelect = document.getElementById("topic");
      topicSelect.innerHTML = "";

      topics.forEach(t => {
        const option = document.createElement("option");
        option.value = t.id;
        option.textContent = t.name;
        topicSelect.appendChild(option);
      });

      loadBranches();
    }

    async function loadBranches() {
      const topicId = document.getElementById("topic").value;
      const res = await fetch(`${API_BASE}/branches?topicId=${topicId}`);
      const branches = await res.json();

      const branchSelect = document.getElementById("branch");
      branchSelect.innerHTML = "";

      branches.forEach(b => {
        const option = document.createElement("option");
        option.value = b.id;
        option.textContent = b.name;
        branchSelect.appendChild(option);
      });

      loadTimeSlots();
    }

    async function loadTimeSlots() {
      const branchId = document.getElementById("branch").value;
      const date = document.getElementById("date").value;

      if (!date) return;

      const res = await fetch(`${API_BASE}/appointments/available?branchId=${branchId}&date=${date}`);
      const slots = await res.json();

      const timeSelect = document.getElementById("time");
      timeSelect.innerHTML = "";

      slots.forEach(s => {
        const option = document.createElement("option");
        option.value = s;
        option.textContent = new Date(s).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        timeSelect.appendChild(option);
      });
    }

    async function bookAppointment() {
      const data = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        branchId: parseInt(document.getElementById("branch").value),
        topicId: parseInt(document.getElementById("topic").value),
        appointmentTime: document.getElementById("time").value
      };

      const messageDiv = document.getElementById("message");
      messageDiv.textContent = "";

      try {
        const res = await fetch(`${API_BASE}/appointments`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        if (!res.ok) throw new Error("Booking failed");

        const result = await res.json();

        messageDiv.className = "success";
        messageDiv.textContent = `Appointment booked for ${new Date(result.appointmentTime).toLocaleString()}`;

        loadTimeSlots();
      } catch (err) {
        messageDiv.className = "error";
        messageDiv.textContent = err.message;
      }
    }

    document.getElementById("topic").addEventListener("change", loadBranches);
    document.getElementById("branch").addEventListener("change", loadTimeSlots);
    document.getElementById("date").addEventListener("change", loadTimeSlots);

    loadTopics();
  </script>
</body>
</html>
